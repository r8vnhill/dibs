---
title: "Void-Safety: Inicialización Tardía"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import ReadingTime from '../../src/components/ReadingTime';

<ReadingTime />

En algunas situaciones, puede que no sea posible inicializar una variable en el momento de su declaración sin sacrificar la claridad o eficiencia del código. Para estos casos, Kotlin proporciona dos herramientas útiles para manejar la **inicialización tardía**: `lateinit` y `Delegates.notNull()`.

## Uso de `lateinit`

- **Propósito**: La palabra clave `lateinit` permite declarar variables no nulas que se inicializarán más adelante en el ciclo de vida del programa. Esto es útil en casos donde la inicialización depende de algún proceso posterior, como inyección de dependencias o configuraciones que no están disponibles al crear el objeto.

- **Aplicabilidad**: Solo puede utilizarse con tipos no primitivos que no sean nulos. No es aplicable para tipos como `Int`, `Double`, etc.

- **Verificación de inicialización**: Kotlin ofrece la opción de verificar si una variable `lateinit` ha sido inicializada con `::variable.isInitialized`. Esto evita errores en tiempo de ejecución si se intenta acceder a una variable sin haberla inicializado.

```kotlin
class Player {
    lateinit var name: String  // Declaración de una variable con inicialización tardía

    fun initializePlayer(name: String) {
        this.name = name  // Asignación del nombre en un momento posterior
    }
}
```

En este ejemplo, la propiedad `name` es declarada pero no se inicializa inmediatamente. Luego, el método `initializePlayer` permite asignar el valor posteriormente.

## Uso de `Delegates.notNull()`

- **Propósito**: `Delegates.notNull()` es una forma de garantizar que una propiedad se inicialice eventualmente. Es útil cuando las variables son de tipos primitivos o cuando no se puede utilizar `lateinit`.

- **Comportamiento**: Si intentas acceder a una propiedad delegada por `notNull()` antes de inicializarla, Kotlin lanzará una `IllegalStateException`, advirtiendo que la propiedad no ha sido configurada correctamente.

```kotlin
import kotlin.properties.Delegates

class Player {
    var lifePoints: Int by Delegates.notNull()  // Delegación que asegura la inicialización obligatoria
}
```

En este ejemplo, `lifePoints` debe ser inicializado antes de ser utilizado, y cualquier intento de acceder a la propiedad antes de su inicialización lanzará una excepción, garantizando un manejo seguro de la nulabilidad.

:::tip Ejercicio: Implementación de un Perfil de Usuario
<Tabs>
    <TabItem value="Ejercicio" label="Ejercicio">
        Desarrolla una clase llamada `Configuration` que gestione dos parámetros de configuración que se inicialicen de manera tardía: `serverUrl` y `timeout`.

        ### Requisitos:
        1. Los campos `serverUrl` y `timeout` deben declararse con inicialización tardía.
        2. La clase debe incluir una función `printConfiguration()` que:
        - Imprima los valores de `serverUrl` y `timeout` si ambos han sido correctamente inicializados.
        - Muestre un mensaje de error indicando qué campo no ha sido inicializado, en caso de que alguno o ambos no lo estén.
    </TabItem>
    <TabItem value="Solución" label="Solución">
        ```kotlin
        class Configuration {

            lateinit var serverUrl: String

            var timeout: Int by Delegates.notNull()

            fun displayInfo() {
                if (this::serverUrl.isInitialized) {
                    try {
                        println("Url: $serverUrl, Timeout: $timeout")
                    } catch (e: IllegalStateException) {
                        println("Timeout has not been initialized")
                    }
                } else {
                    println("Url has not been initialized") +
                }
            }
        }
        ```
    </TabItem>
</Tabs>
:::