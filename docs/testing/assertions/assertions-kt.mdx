---
title: Aserciones
---
import ReadingTime from '@site/src/components/ReadingTime'
import { ProCons, Pros, Cons } from '@site/src/components/cajitas/ProCons'
import References from '@site/src/components/ReferencesComponent'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import Exercise from '@site/src/components/exercise/Exercise'
import Solution from '@site/src/components/exercise/Solution'
import Hint from '@site/src/components/exercise/Hint'
import Definition from '@site/src/components/Definition'
import Corollary from '@site/src/components/Corollary'
import GithubRepoLink from '@site/src/components/GithubRepoLink'
import { LanguageCard } from '@site/src/components/cards/LanguageCard'
import Explanation from '@site/src/components/admonitions/Explanation'
import RepoClone from '@site/src/components/admonitions/RepoClone'
import CodeBlock from '@theme/CodeBlock'

<ReadingTime />
<GithubRepoLink repo={"assertions-kt"} user={"r8vnhill"}/>
<RepoClone repoName={"assertions-kt"} />

<details>
    <summary>
        Comencemos por crear un módulo para la lección...
    </summary>

    <BoxedTabs groupId={"os"}>
        <TabItem value="Windows" label="Windows">
            ```powershell
            New-Item -Path 'assert' -ItemType Directory
            '// Intentionally left blank' |
                Out-File -FilePath 'assert/build.gradle.kts'
            ```
        </TabItem>
        <TabItem value="Windows (corto)" label="Windows (corto)">
            ```powershell
            md 'assert'
            '// Intentionally left blank' > 'assert/build.gradle.kts'
            ```
        </TabItem>
        <TabItem value="Linux/Mac" label="Linux/Mac">
            ```bash
            mkdir -p 'assert'
            echo '// Intentionally left blank' > 'assert/build.gradle.kts'
            ```
        </TabItem>
    </BoxedTabs>

    Recuerda agregar el nuevo módulo al archivo `settings.gradle.kts`.
</details>

Las **aserciones** son instrucciones que verifican si una condición específica es verdadera en un punto particular del código. Si la condición es falsa, la aserción falla y se lanza una excepción, interrumpiendo la ejecución del programa o prueba. Los frameworks de testing capturan estas excepciones para generar reportes detallados de los resultados.

## Implementación manual

<details>
    <summary>
        Si quieres crear los archivos desde la terminal...
    </summary>

    <BoxedTabs groupId={"os"}>
        <TabItem value="Windows" label="Windows">
            ```powershell
            $Group = 'com\github\username'
            ```

            ```powershell
            $CalculatorTestDir = "assert\src\test\kotlin\$Group\calculator"
            $CalculatorMainDir = "assert\src\main\kotlin\$Group\calculator"
            $CalculatorTestDir | New-Item -ItemType Directory -Force
            $CalculatorMainDir | New-Item -ItemType Directory -Force
            "package $Group.calculator" -replace '\\', '.' | 
                Out-File -FilePath "$CalculatorTestDir\CalculatorTest.kt"
            "package $Group.calculator" -replace '\\', '.' |
                Out-File -FilePath "$CalculatorMainDir\Calculator.kt"
            ```
        </TabItem>
        <TabItem value="Windows (corto)" label="Windows (corto)">
            ```powershell
            $Group = 'com\github\username'
            ```

            ```powershell
            $CalculatorTestDir = "assert\src\test\kotlin\$Group\calculator"
            $CalculatorMainDir = "assert\src\main\kotlin\$Group\calculator"
            $CalculatorTestDir, $CalculatorMainDir | % { md $_ }
            "package $Group.calculator" -replace '\\', '.' > `
                "$CalculatorTestDir\CalculatorTest.kt"
            "package $Group.calculator" -replace '\\', '.' > `
                "$CalculatorMainDir\Calculator.kt"
            ```
        </TabItem>
        <TabItem value="Linux/Mac" label="Linux/Mac">
            ```bash
            GROUP="com/github/username"
            ```

            ```bash
            CALCULATOR_TEST_DIR="assert/src/test/kotlin/$GROUP/calculator"
            CALCULATOR_MAIN_DIR="assert/src/main/kotlin/$GROUP/calculator"
            mkdir -p "$CALCULATOR_TEST_DIR" "$CALCULATOR_MAIN_DIR"
            echo "package ${GROUP//\//.}.calculator" > \
                "$CALCULATOR_TEST_DIR/CalculatorTest.kt"
            echo "package ${GROUP//\//.}.calculator" > \
                "$CALCULATOR_MAIN_DIR/Calculator.kt"
            ```
        </TabItem>
    </BoxedTabs>
</details>

Por ejemplo, consideremos una prueba escrita manualmente:

<BoxedTabs>
    <TabItem label={"Código esencial"} value={"Código esencial"}>
        ```kotlin showLineNumbers
        "Given a calculator" - {
            "when adding 1 and 2" - {
                "should return 3" {
                    Calculator.add(1, 2).takeIf { it == 3 } 
                        ?: throw AssertionError("1 + 2 should be 3")
                }
            }
        }
        ```
    </TabItem>
    <TabItem label={"Código completo"} value={"Código completo"}>
        ```kotlin showLineNumbers title="assert/src/test/kotlin/com/github/username/calculator/CalculatorTest.kt"
        package com.github.username.calculator
        
        import io.kotest.core.spec.style.FreeSpec

        class CalculatorTest : FreeSpec({
            "A calculator" - {
                "when adding 1 and 2" - {
                    "should return 3 (manual)" {
                        Calculator.add(1, 2).takeIf { it == 3 } 
                            ?: throw AssertionError("1 + 2 should be 3")
                    }
                }
            }
        })
        ```
    </TabItem>
</BoxedTabs>

<Explanation>
    En este código, verificamos si `Calculator.add(1, 2)` es igual a `3`. Si no lo es, lanzamos una excepción `AssertionError` con un mensaje descriptivo; de lo contrario, imprimimos `"Test passed"`.
</Explanation>

Supongamos ahora que tenemos la siguiente implementación errónea de ``Calculator``:

```kotlin title="assert/src/main/kotlin/com/github/username/calculator/Calculator.kt"
package com.github.username.calculator

object Calculator {
    fun add(a: Int, b: Int): Int = a - b
}
```

En este caso, si ejecutamos el test obtendremos la siguiente salida:

```plaintext
java.lang.AssertionError: 1 + 2 should be 3
	at com.github.username.assertions.CalculatorTest$1$1.invokeSuspend(CalculatorTest.kt:8)
	at com.github.username.assertions.CalculatorTest$1$1.invoke(CalculatorTest.kt)
	at com.github.username.assertions.CalculatorTest$1$1.invoke(CalculatorTest.kt)
	at io.kotest.core.spec.style.scopes.FreeSpecRootScope$invoke$1.invokeSuspend(FreeSpecRootScope.kt:26)
	...
Caused by: java.lang.AssertionError: 1 + 2 should be 3
	at com.github.username.assertions.CalculatorTest$1$1.invokeSuspend(CalculatorTest.kt:8)
	at com.github.username.assertions.CalculatorTest$1$1.invoke(CalculatorTest.kt)
	at com.github.username.assertions.CalculatorTest$1$1.invoke(CalculatorTest.kt)
	at io.kotest.core.spec.style.scopes.FreeSpecRootScope$invoke$1.invokeSuspend(FreeSpecRootScope.kt:26)
	...
```

Sin embargo, podemos simplificar y mejorar este test utilizando las aserciones que ofrece el framework:

<BoxedTabs>
    <TabItem label={"Código esencial"} value={"Código esencial"}>
        ```kotlin
        Calculator.add(1, 2).takeIf { it == 3 }
            ?: fail("1 + 2 should be 3")
        ```
    </TabItem>
    <TabItem label={"Código completo"} value={"Código completo"}>
        ```kotlin showLineNumbers title="assert/src/test/kotlin/com/github/username/calculator/CalculatorTest.kt"
        package com.github.username.calculator

        import io.kotest.assertions.fail
        import io.kotest.core.spec.style.FreeSpec

        class CalculatorTest : FreeSpec({
            "A calculator" - {
                "when adding 1 and 2" - {
                    "should return 3"  - {
                        Calculator.add(1, 2).takeIf { it == 3 }
                            ?: fail("1 + 2 should be 3")
                    }
                }
            }
        })
        ```
    </TabItem>
</BoxedTabs>

<Explanation>
    Aquí, en lugar de lanzar una excepción manualmente, utilizamos la función `fail` proporcionada por el framework, que marca la prueba como fallida y proporciona el mensaje de error correspondiente. Esto también ayudará al framework a generar un informe detallado de la prueba.
</Explanation>

## Implementación de Aserciones Personalizadas

<details>
    <summary>
        Si quieres crear los archivos desde la terminal...
    </summary>

    <BoxedTabs groupId={"os"}>
        <TabItem value="Windows" label="Windows">
            ```powershell
            $AssertionsDir = "assert\src\test\kotlin\$Group\assertions"
            New-Item -Path $AssertionsDir -ItemType Directory -Force
            "package $Group.assertions" -replace '\\', '.' | 
                Out-File -FilePath "$AssertionsDir\AssertTrue.kt"
            ```
        </TabItem>
        <TabItem value="Windows (corto)" label="Windows (corto)">
            ```powershell
            $AssertionsDir = "assert\src\test\kotlin\$Group\assertions"
            md $AssertionsDir
            "package $Group.assertions" -replace '\\', '.' > `
                "$AssertionsDir\AssertTrue.kt"
            ```
        </TabItem>
        <TabItem value="Linux/Mac" label="Linux/Mac">
            ```bash
            ASSERTIONS_DIR="assert/src/test/kotlin/$GROUP/assertions"
            mkdir -p "$ASSERTIONS_DIR"
            echo "package ${GROUP//\//.}.assertions" > \
                "$ASSERTIONS_DIR/AssertTrue.kt"
            ```
        </TabItem>
    </BoxedTabs>
</details>

Supongamos ahora que queremos implementar nuestras propias funciones de aserción personalizadas para simplificar la escritura de pruebas. Por ejemplo, podemos crear una función `assertTrue` que verifique si una condición es verdadera y lance una excepción si no lo es.

```kotlin title="assert/src/test/kotlin/com/github/username/assertions/assertTrue.kt"
package com.github.username.assertions

import io.kotest.assertions.fail

fun assertTrue(
    condition: Boolean,
    message: String = "Condition is not true"
) {
    if (!condition) {
        fail(message)
    }
}
```

<Explanation>
    La función `assertTrue` toma dos parámetros:

    - `condition`: la condición que se debe cumplir.
    - `message`: el mensaje de error que se mostrará si la condición no se cumple.

    Si la condición no se cumple, se lanza una excepción `AssertionError` con el mensaje especificado.
</Explanation>

### Ejemplo de uso en tu prueba

<BoxedTabs>
    <TabItem label={"Código esencial"} value={"Código esencial"}>
        ```kotlin showLineNumbers
        assertTrue(Calculator.add(1, 2) == 3, "1 + 2 should be 3")
        ```
    </TabItem>
    <TabItem label={"Código completo"} value={"Código completo"}>
        ```kotlin showLineNumbers title="assert/src/test/kotlin/com/github/username/calculator/CalculatorTest.kt"
        package com.github.username.calculator

        import com.github.username.assertions.assertTrue
        import io.kotest.core.spec.style.FreeSpec

        class CalculatorTest : FreeSpec({
            "A calculator" - {
                "when adding 1 and 2" - {
                    "should return 3"  - {
                        assertTrue(Calculator.add(1, 2) == 3, "1 + 2 should be 3")
                    }
                }
            }
        })
        ```
    </TabItem>
</BoxedTabs>

<Explanation>
    En este ejemplo, utilizamos la función `assertTrue` para verificar si `Calculator.add(1, 2)` es igual a `3`. Si la condición no se cumple, se lanza una excepción con el mensaje `"1 + 2 should be 3"`.
</Explanation>

## Beneficios y limitaciones

<ProCons>
    <Pros>
        - **Claridad y Reusabilidad**: Las aserciones personalizadas mejoran la legibilidad del código de pruebas y permiten reutilizar las mismas aserciones en diferentes casos, reduciendo duplicaciones.
        - **Mensajes de error personalizados**: Permite proporcionar mensajes de error más claros y específicos, lo que facilita la identificación de fallos en las pruebas.
        - **Abstracción de complejidad**: Las aserciones personalizadas ocultan detalles complejos de validación, dejando las pruebas más concisas y fáciles de mantener.
        - **Integración con frameworks**: Al crear aserciones personalizadas, se puede integrar fácilmente con frameworks de testing como Kotest, aprovechando su capacidad de generar informes detallados.
    </Pros>
    <Cons>
        - **Mayor mantenimiento**: Si las aserciones personalizadas no están bien diseñadas o documentadas, pueden ser difíciles de mantener y propensas a errores si los requisitos cambian.
        - **Sobrecarga inicial**: Crear aserciones personalizadas desde cero puede llevar más tiempo y esfuerzo inicialmente, comparado con el uso de aserciones predefinidas de los frameworks.
    </Cons>
</ProCons>

<Exercise title={"Verificar si una lista está ordenada"}>
    Crea una aserción ``assertIsOrdered: (List<Int>, Boolean) -> Unit`` que verifique si una lista de enteros está ordenada de forma ascendente.
    - Si el segundo parámetro es ``true``, la lista debe estar ordenada de forma estrictamente ascendente (sin elementos repetidos).
    - Si el segundo parámetro es ``false``, la lista puede contener elementos repetidos.

    <Solution>
        ```kotlin showLineNumbers
        fun assertIsOrdered(list: List<Int>, isStrictlyOrdered: Boolean) {
            if (isStrictlyOrdered) {
                for (i in 0..<list.size - 1) {
                    if (list[i] >= list[i + 1]) {
                        fail("List is not strictly ordered")
                    }
                }
            } else {
                for (i in 0..<list.size - 1) {
                    if (list[i] > list[i + 1]) {
                        fail("List is not ordered")
                    }
                }
            }
        }
        ```
    </Solution>

    <Solution title='(Alternativa)'>
        ```kotlin showLineNumbers
        fun assertIsOrdered(list: List<Int>, isStrictlyOrdered: Boolean) {
            if (isStrictlyOrdered) {
                list.zipWithNext { a, b -> 
                    if (a >= b) {
                        fail("List is not strictly ordered") 
                    }
                }
            } else {
                list.zipWithNext { a, b -> 
                    if (a > b) {
                        fail("List is not ordered") 
                    }
                }
            }
        }
        ```

        :::info Explicación de la solución alternativa

        - Utilizamos `zipWithNext` para obtener pares consecutivos de elementos en la lista.
        - Utilizamos una lambda para verificar si cada par cumple con la condición de orden.
        - Si la condición no se cumple, lanzamos una excepción con el mensaje correspondiente.

        :::
    </Solution>
</Exercise>

## ¿Qué aprendimos?

En este módulo, exploramos las **aserciones** y cómo implementarlas tanto manualmente como utilizando frameworks de pruebas como Kotest. También aprendimos a crear **aserciones personalizadas** para simplificar las pruebas y proporcionar mensajes de error más claros y específicos.

### Puntos clave

- Las aserciones son fundamentales para verificar que el comportamiento del código cumple con las expectativas.
- Usar aserciones manuales es útil, pero los frameworks de testing proporcionan herramientas más potentes y legibles.
- Crear aserciones personalizadas mejora la claridad y reusabilidad del código de pruebas.
- La función `fail` facilita el manejo de fallos en pruebas, proporcionando un flujo más claro que lanzar manualmente excepciones.

---

Las aserciones son una herramienta clave para garantizar la calidad del software, ayudando a detectar errores y asegurarse de que el comportamiento del código es el esperado en diferentes escenarios.

xUnit Patterns. (2003). En K. Beck, Test-driven development: By example. Addison-Wesley.

<References references={[
    {
        title: "xUnit Patterns",
        bookTitle: "Test-driven development: By example",
        publisher: "Addison-Wesley",
        year: "2003",
        author: "K. Beck",
        type: "book",
    },
]} additionalReferences={[
    {
        accessedDate: '31 de julio de 2024',
        siteOrAuthor: 'Wikipedia',
        title: 'Assertion (Software Development)',
        type: 'web',
        url: 'https://en.wikipedia.org/w/index.php?title=Assertion_(software_development)&oldid=1237703007',
    },
    {
        accessedDate: '31 de julio de 2024',
        siteOrAuthor: 'Wikipedia',
        title: 'Test assertion',
        type: 'web',
        url: 'https://en.wikipedia.org/w/index.php?title=Test_assertion&oldid=1110777862',
    },
]}/>
